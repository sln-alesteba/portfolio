```{r setup, include=FALSE}

library(trj3D)

```

For the understanding of different metrics we are going to study their statistical behavior with many trajectory samples (generated synthetically). To compare the metrics different rediscretization step lengths will be used.

```{r}

library(plot3D)

n <- 25

angularErrorSd <- runif(n, 0, 0.15)

trjs <- lapply(1:n, function(i) trj3D::generate_3D(n=25 , angular_errorSd = angularErrorSd[i]))

```

Let's apply different rediscretization values to the generated trajectories.

```{r}

stepSizes <- c(1, 2, 5)

reds <- lapply(stepSizes, function(ss) lapply(1:n, function(i) trj3D::resample (trjs[[i]], ss)))

```


## Straigthness

The simplest index to consider is the relationship between the distance and the length. The distance is the difference between the first and last point and the length computes the full perimeter along the trajectory shape.

```{r}

ds <- sapply(reds, function(rtrjs) sapply(1:n, function(i) trj3D::straightness(rtrjs[[i]])))

plot(rep(angularErrorSd, 3), ds,
     pch = 16, cex = .8,
     col = c(rep('red', n), rep('blue', n), rep('darkgreen', n)),
     xlab = expression(sigma[Delta]), ylab = "Straightness")

points(rep(angularErrorSd, 3), ds,
     pch = 3, cex = .8,
     col = c(rep('red', n), rep('blue', n), rep('darkgreen', n)))

legend("bottomright", paste("Step length", stepSizes), 
       pch = 16, 
       col = c("red", "blue", "darkgreen"), inset = 0.01)
```
The mean of turning angles, the following cell plots the mean Turning angles vs angular error.

```{r}

rs <- sapply(reds, function(rtrjs) sapply(1:n, function(i) Mod(trj3D::meanTurningAngles(rtrjs[[i]]))))

plot(rep(angularErrorSd, 3), rs,
     pch = 16, cex = .8,
     col = c(rep('red', n), rep('blue', n), rep('darkgreen', n)),
     xlab = expression(sigma["angular error"]), ylab = "Mean Turning Angles")

legend("bottomright", paste("Step length", stepSizes), 
       pch = 16, col = c("red", "blue", "darkgreen"), inset = 0.01)
```

## Sinuosity

The sinuosity index defined by Benhamou (2004) may be an appropriate measure of the tortuosity of a random search path. Sinuosity is a function of the mean cosine of turning angles, and is a corrected form of the original sinuosity index defined by Bovet & Benhamou (1988)

```{r}

sins <- sapply(reds, function(rtrjs) sapply(1:n, function(i) trj3D::sinuosity (rtrjs[[i]])))

plot(rep(angularErrorSd, 3), sins,
     pch = 16, cex = .8,
     col = c(rep('red', n), rep('blue', n), rep('darkgreen', n)),
     xlab = expression(sigma["angular error"]), ylab = "Sinuosity")

legend("bottomright", paste("Step length", stepSizes), 
       pch = 16, col = c("red", "blue", "darkgreen"), inset = 0.01)

```

## Directional Autocorrelation

The direction autocorrelation function was devised to detect and quantify regularities within trajectories. It detects wave-like periodicities, and provides an indication of their wavelength and amplitude.


```{r}

par(mfrow = c(1,2))

angularErrorSd <- runif(n, 0, 0.15)

trj <- trj3D::generate_3D(n=50 , angular_errorSd = angularErrorSd)

lines3D(trj$x, trj$y, trj$z) 

corr <- trj3D::directionalAutocorrelations(trj)

plot(corr)

```


## Emax

Eamax is a dimensionless estimate of the maximum expected displacement of a trajectory. Larger Emax values (approaching infinity) represent straighter paths. Plot Emax vs angular error on log axes

```{r}

emaxs <- sapply(reds, function(rtrjs) sapply(1:n, function(i) trj3D::emax (rtrjs[[i]])))
emaxs[emaxs < 0] <- NA

plot(rep(angularErrorSd, 3), emaxs,
     log = 'xy',
     pch = 16, cex = .8, 
     col = c(rep('red', n), rep('blue', n), rep('darkgreen', n)),
     xlab = expression(sigma["angular error"]), ylab = expression(E[max]))

legend("bottomleft", c("Step length 1", "Step length 2", "Step length 10"), 
       pch = 16, col = c("red", "blue", "darkgreen"), inset = 0.01)

```






